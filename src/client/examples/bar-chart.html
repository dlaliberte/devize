<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Devize - Bar Chart</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }

    h1 {
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .viz-container {
      width: 100%;
      height: 400px;
      border: 1px solid #ddd;
      margin: 20px 0;
      border-radius: 4px;
    }

    pre {
      background-color: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }

    .back-link {
      display: inline-block;
      margin-top: 20px;
      color: #0066cc;
      text-decoration: none;
    }

    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bar Chart Visualization</h1>
    <p>This example demonstrates creating a simple bar chart with data binding using Devize.</p>

    <div id="visualization-container" class="viz-container"></div>

    <h2>Code</h2>
    <pre><code>// Sample data
const data = [
  { category: "A", value: 5 },
  { category: "B", value: 10 },
  { category: "C", value: 15 },
  { category: "D", value: 7 },
  { category: "E", value: 12 }
];

// Create a labeled bar chart
const labeledBarChart = createViz({
  type: "group",
  children: [
    // First, add the bars
    ...data.map((item, index) => ({
      type: "rectangle",
      x: index * 60 + 50,
      y: 250 - item.value * 10,
      width: 40,
      height: item.value * 10,
      fill: "steelblue",
      stroke: "navy",
      strokeWidth: 1
    })),

    // Then, add category labels
    ...data.map((item, index) => ({
      type: "text",
      x: index * 60 + 70,  // Center of the bar
      y: 270,              // Below the baseline
      text: item.category,
      fontSize: 14,
      fontFamily: "Arial",
      fill: "black",
      textAnchor: "middle"
    })),

    // Finally, add value labels
    ...data.map((item, index) => ({
      type: "text",
      x: index * 60 + 70,  // Center of the bar
      y: 245 - item.value * 10,  // Above the bar
      text: item.value.toString(),
      fontSize: 12,
      fontFamily: "Arial",
      fill: "white",
      textAnchor: "middle"
    }))
  ]
}, document.getElementById("visualization-container"));</code></pre>

    <h2>Update the Visualization</h2>
    <p>Click the button below to update the chart with new data:</p>
    <button id="update-button">Update Data</button>

    <pre><code>// New data
const updatedData = [
  { category: "A", value: 8 },
  { category: "B", value: 4 },
  { category: "C", value: 12 },
  { category: "D", value: 16 },
  { category: "E", value: 6 }
];

// Update the visualization
updateViz(labeledBarChart, {
  children: [
    // Updated bars
    ...updatedData.map((item, index) => ({
      type: "rectangle",
      x: index * 60 + 50,
      y: 250 - item.value * 10,
      width: 40,
      height: item.value * 10,
      fill: "steelblue",
      stroke: "navy",
      strokeWidth: 1
    })),

    // Updated category labels
    ...updatedData.map((item, index) => ({
      type: "text",
      x: index * 60 + 70,
      y: 270,
      text: item.category,
      fontSize: 14,
      fontFamily: "Arial",
      fill: "black",
      textAnchor: "middle"
    })),

    // Updated value labels
    ...updatedData.map((item, index) => ({
      type: "text",
      x: index * 60 + 70,
      y: 245 - item.value * 10,
      text: item.value.toString(),
      fontSize: 12,
      fontFamily: "Arial",
      fill: "white",
      textAnchor: "middle"
    }))
  ]
});</code></pre>

    <a href="/examples/" class="back-link">‚Üê Back to Examples</a>
  </div>

  <script>
    // Helper function to ensure SVG exists
    function ensureSvg(container) {
      let svg = container.querySelector('svg');
      if (!svg) {
        svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', '100%');
        svg.setAttribute('height', '100%');
        container.appendChild(svg);
      }
      return svg;
    }

    // Create a visualization from a spec
    function createViz(spec, container) {
      if (spec.type === "group") {
        return createGroup(spec, container);
      } else if (spec.type === "rectangle") {
        return createRectangle(spec, container);
      } else if (spec.type === "text") {
        return createText(spec, container);
      }

      // Default fallback
      console.error("Unknown visualization type:", spec.type);
      return null;
    }

    // Create a rectangle
    function createRectangle(spec, container) {
      const svg = ensureSvg(container);

      // Create rectangle element
      const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');

      // Set attributes from spec
      rect.setAttribute('x', spec.x || 0);
      rect.setAttribute('y', spec.y || 0);
      rect.setAttribute('width', spec.width || 0);
      rect.setAttribute('height', spec.height || 0);

      // Set style attributes
      if (spec.fill) rect.setAttribute('fill', spec.fill);
      if (spec.stroke) rect.setAttribute('stroke', spec.stroke);
      if (spec.strokeWidth) rect.setAttribute('stroke-width', spec.strokeWidth);
      if (spec.rx) rect.setAttribute('rx', spec.rx);
      if (spec.ry) rect.setAttribute('ry', spec.ry);
      if (spec.opacity) rect.setAttribute('opacity', spec.opacity);

      // Add to SVG
      svg.appendChild(rect);

      // Return the visualization instance
      return {
        element: rect,
        spec: spec
      };
    }

    // Create text
    function createText(spec, container) {
      const svg = ensureSvg(container);

      // Create text element
      const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');

      // Set attributes from spec
      text.setAttribute('x', spec.x || 0);
      text.setAttribute('y', spec.y || 0);

      // Set style attributes
      if (spec.fill) text.setAttribute('fill', spec.fill);
      if (spec.fontSize) text.setAttribute('font-size', spec.fontSize);
      if (spec.fontFamily) text.setAttribute('font-family', spec.fontFamily);
      if (spec.fontWeight) text.setAttribute('font-weight', spec.fontWeight);
      if (spec.textAnchor) text.setAttribute('text-anchor', spec.textAnchor);
      if (spec.dominantBaseline) text.setAttribute('dominant-baseline', spec.dominantBaseline);
      if (spec.opacity) text.setAttribute('opacity', spec.opacity);

      // Set the text content
      text.textContent = spec.text || '';

      // Add to SVG
      svg.appendChild(text);

      // Return the visualization instance
      return {
        element: text,
        spec: spec
      };
    }

    // Create a group
    function createGroup(spec, container) {
      const svg = ensureSvg(container);

      // Create group element
      const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');

      // Set transform if provided
      if (spec.transform) {
        group.setAttribute('transform', spec.transform);
      }

      // Add to SVG
      svg.appendChild(group);

      // Create child visualizations
      const children = [];
      if (spec.children && Array.isArray(spec.children)) {
        for (const childSpec of spec.children) {
          // Create a temporary container for the child
          const tempContainer = {
            querySelector: () => svg,
            appendChild: () => {} // No-op since we're using the existing SVG
          };

          // Create the child visualization
          const child = createViz(childSpec, tempContainer);

          // If it's a valid child, add it to our children array
          if (child) {
            children.push(child);
          }
        }
      }

      // Return the visualization instance
      return {
        element: group,
        spec: spec,
        children: children
      };
    }

    // Update a visualization
    function updateViz(vizInstance, newSpec) {
      if (!vizInstance || !vizInstance.element) {
        throw new Error('Invalid visualization instance');
      }

      // Get the container and SVG
      const svg = vizInstance.element.ownerSVGElement;
      const container = svg.parentNode;

      // Clear the SVG
      while (svg.firstChild) {
        svg.removeChild(svg.firstChild);
      }

      // Create a new visualization with the updated spec
      return createViz({...vizInstance.spec, ...newSpec}, container);
    }

    // Sample data
    const data = [
      { category: "A", value: 5 },
      { category: "B", value: 10 },
      { category: "C", value: 15 },
      { category: "D", value: 7 },
      { category: "E", value: 12 }
    ];

    // Create a labeled bar chart
    const labeledBarChart = createViz({
      type: "group",
      children: [
        // First, add the bars
        ...data.map((item, index) => ({
          type: "rectangle",
          x: index * 60 + 50,
          y: 250 - item.value * 10,
          width: 40,
          height: item.value * 10,
          fill: "steelblue",
          stroke: "navy",
          strokeWidth: 1
        })),

        // Then, add category labels
        ...data.map((item, index) => ({
          type: "text",
          x: index * 60 + 70,  // Center of the bar
          y: 270,              // Below the baseline
          text: item.category,
          fontSize: 14,
          fontFamily: "Arial",
          fill: "black",
          textAnchor: "middle"
        })),

        // Finally, add value labels
        ...data.map((item, index) => ({
          type: "text",
          x: index * 60 + 70,  // Center of the bar
          y: 245 - item.value * 10,  // Above the bar
          text: item.value.toString(),
          fontSize: 12,
          fontFamily: "Arial",
          fill: "white",
          textAnchor: "middle"
        }))
      ]
    }, document.getElementById("visualization-container"));

    // Add event listener to the update button
    document.getElementById('update-button').addEventListener('click', function() {
      // New data
      const updatedData = [
        { category: "A", value: 8 },
        { category: "B", value: 4 },
        { category: "C", value: 12 },
        { category: "D", value: 16 },
        { category: "E", value: 6 }
      ];

      // Update the visualization
      updateViz(labeledBarChart, {
        children: [
          // Updated bars
          ...updatedData.map((item, index) => ({
            type: "rectangle",
            x: index * 60 + 50,
            y: 250 - item.value * 10,
            width: 40,
            height: item.value * 10,
            fill: "steelblue",
            stroke: "navy",
            strokeWidth: 1
          })),

          // Updated category labels
          ...updatedData.map((item, index) => ({
            type: "text",
            x: index * 60 + 70,
            y: 270,
            text: item.category,
            fontSize: 14,
            fontFamily: "Arial",
            fill: "black",
            textAnchor: "middle"
          })),

          // Updated value labels
          ...updatedData.map((item, index) => ({
            type: "text",
            x: index * 60 + 70,
            y: 245 - item.value * 10,
            text: item.value.toString(),
            fontSize: 12,
            fontFamily: "Arial",
            fill: "white",
            textAnchor: "middle"
          }))
        ]
      });
    });
  </script>
</body>
</html>
